---
description: 要件確認→仕様設計→実装→検証の開発ワークフロー
argument-hint: 要件の説明（例: WebSocket reconnect 機能を追加）
allowed-tools: Bash, Read, Write, Edit, Grep, Glob, Task, TaskGet, TaskUpdate, TaskList, TaskCreate, AskUserQuestion, EnterPlanMode
---

引数テキストを要件として扱う。

## Phase 1: 要件確認

1. 要件に関連する既存コードを調査:
   - Glob/Grep で影響するファイルを特定
   - `src/` の関連モジュールを確認
   - `frontend/` の関連ファイルを確認
2. 以下をまとめてユーザーに提示:
   - **やること**: 要件の箇条書き
   - **影響範囲**: 変更が必要なファイル一覧
   - **制約・注意点**: 既存機能への影響
   - **不明点**: あれば AskUserQuestion で確認

→ **承認待ち**

## Phase 2: 仕様設計

1. 実装アプローチを検討（複数案がある場合は比較表を作成）
2. 以下を設計してユーザーに提示:
   - **データ構造**: 型・構造体の追加/変更
   - **API 設計**: エンドポイント・WebSocket メッセージの追加/変更
   - **フロントエンド**: JS モジュール・UI の変更
   - **ファイル一覧**: 追加・変更するファイルと概要
3. 変更が大きい場合はサブタスクに分割（TaskCreate）

→ **承認待ち**

## Phase 3: 実装

1. 仕様に基づいて段階的に実装
2. 各ステップでビルド確認:
   ```
   cargo check
   ```
3. コンパイルエラーがあれば即修正（最大3回試行）
4. 実装完了後、変更差分の概要をユーザーに提示

→ **承認待ち**（差分レビュー）

## Phase 4: 検証

1. Task ツールで checker エージェントを起動し自動検証を実行
2. 失敗がある場合は修正して再検証（最大3回）
3. 全パス後:
   - 手動確認が必要な項目があればチェックリストで提示

→ **完了報告**

## エスカレーション

- コンパイル/ビルドエラーは最大 **3回** 修正を試みる
- 3回で解決しない場合はエラー内容をユーザーに報告し判断を仰ぐ
- 仕様の不明点は Phase 中でも AskUserQuestion で即確認する

## 完了条件

- [ ] `cargo check` 通過
- [ ] `cargo build` 成功
- [ ] `cargo clippy` 警告なし
- [ ] `cargo test` 通過（テストがある場合）
